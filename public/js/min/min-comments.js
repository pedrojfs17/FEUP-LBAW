function commentEventListener(e){let t=e.getElementsByClassName("btn-add-reply");Array.from(t).forEach(e=>e.addEventListener("click",function(){sendReplyRequest(e)}));let n=e.getElementsByClassName("btn-add-comment");Array.from(n).forEach(e=>e.addEventListener("click",function(){sendCommentRequest(e)}))}function addReply(e,t){document.getElementById("comment"+e+"replyDiv").innerHTML+=t}function addComment(e){let t=document.querySelectorAll(".task-comments")[0];t.innerHTML+=e,commentEventListener(t)}function getDate(){let e=(new Date).toISOString().split("T");return e[0]+" "+e[1].substr(0,8)}function sendReplyRequest(e){e.disabled=!0;let t=document.getElementById("replyTo"+e.dataset.comment),n=t.value.trim();sendAjaxRequest("POST",e.dataset.href,encodeForAjax({_token:document.querySelector('input[name="_token"]').value,text:n,parent:e.dataset.comment,date:getDate(),author:e.dataset.author}),n=>{addReply(e.dataset.comment,n),t.value="";let a=new Event("change");t.dispatchEvent(a),e.disabled=!1},t=>{serverSideValidation(e.form,t),e.disabled=!1})}function sendCommentRequest(e){e.disabled=!0;let t=document.getElementById("commentOn"+e.dataset.task),n=t.value.trim();sendAjaxRequest("POST",e.dataset.href,encodeForAjax({_token:document.querySelector('input[name="_token"]').value,text:n,date:getDate(),author:e.dataset.author}),n=>{addComment(n),t.value="";let a=new Event("change");t.dispatchEvent(a),e.disabled=!1},t=>{serverSideValidation(e.form,t),e.disabled=!1})}
