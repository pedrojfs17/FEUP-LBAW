function taskEventListener(e){const t=e.querySelectorAll(".tag-selection"),n=e.querySelector(".subtask-selection"),a=e.querySelector(".waiting-selection"),r=e.querySelector(".assign-selection"),o=e.querySelectorAll(".edit-task"),c=e.querySelectorAll(".checklist-item");t.forEach(e=>{$(e).select2({width:"100%",allowClear:!0,dropdownParent:$(e).parent()})}),$(n).select2({width:"100%",allowClear:!0,dropdownParent:$(n).parent()}),$(a).select2({width:"100%",allowClear:!0,dropdownParent:$(a).parent()}),$(r).select2({width:"100%",allowClear:!0,dropdownParent:$(r).parent()}),addInputEventListener(),c.forEach(e=>{addCheckListItems(e)}),o.forEach(e=>{let t=e.parentElement.querySelector("form");t.addEventListener("submit",function(e){e.preventDefault();let n={},a=new FormData(t);a.forEach((e,t)=>{1===a.getAll(t).length?n[t]=e:n[t]=a.getAll(t)});sendPatchAjaxRequest(t.dataset.href,n,function(e){let n=JSON.parse(e);updateCard(n.taskID,n.taskCard),updateTaskModal(t.dataset.id,n.modalChanges)})}),e.addEventListener("click",function(n){"false"===e.dataset.editing?(e.innerHTML='<i class="bi bi-check2"></i>',e.dataset.editing="true"):(e.innerHTML='<i class="bi bi-pencil"></i>',e.dataset.editing="false",t.querySelector('button[type="submit"]').click())})}),initializeTooltips(),initializePopovers()}function sendPatchAjaxRequest(e,t,n){let a=new XMLHttpRequest;a.open("PATCH",e),a.setRequestHeader("Accept","application/json"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4===a.readyState&&200===a.status&&n(this.responseText)},a.send(encodeForAjax(t))}function updateCard(e,t){const n=document.querySelector("#overview"),a=document.querySelector("#task-"+e);if(!a)return;a.innerHTML="";let r=document.createElement("div");r.innerHTML=t;let o=r.children[0];n.insertBefore(o,a),a.remove();const c=document.querySelector("#task-"+e).querySelector(".open-task");addGetEventListener(c,null,onModalReceived),o.querySelectorAll(".text-bg-check").forEach(e=>checkColor(e))}function addCheckListItems(e){let t=e.querySelectorAll(".delete-item"),n=e.querySelectorAll(".form-check-input"),a=function(t){updateCard(t.taskID,t.taskCard),updateTaskModal(e.dataset.id,t.modalChanges);const n=document.querySelectorAll(".checklist-item");addInputEventListener(),n.forEach(e=>{addCheckListItems(e)})};t.forEach(t=>t.addEventListener("click",()=>{sendAjaxRequest("DELETE",e.dataset.href,encodeForAjax({_token:csrfToken}),a)})),n.forEach(t=>t.addEventListener("click",()=>{sendAjaxRequest("PATCH",e.dataset.href,encodeForAjax({completed:t.checked,_token:csrfToken}),a)}))}function addInputEventListener(){const e=document.querySelector("#addItem");if(!e)return;const t=e.querySelector('input[name="new_item"]');t.addEventListener("keypress",function(n){let a=t.parentElement.parentElement;a.addEventListener("submit",e=>{e.preventDefault()});let r=function(e){updateCard(e.taskID,e.taskCard),updateTaskModal(a.dataset.id,e.modalChanges);const t=document.querySelectorAll(".checklist-item");addInputEventListener(),t.forEach(e=>{addCheckListItems(e)})};"Enter"===n.key&&(sendAjaxRequest("POST",e.dataset.href,encodeForAjax({new_item:t.value,_token:csrfToken}),r),a.reset())})}function updateTaskModal(e,t){let n=document.getElementById(e),a=document.createRange().createContextualFragment(t).firstChild;a.querySelectorAll(".text-bg-check").forEach(e=>checkColor(e)),n.parentElement.replaceChild(a,n)}
